---
title: "Tidy data"
output: github_document
---

```{r setup}
library(tidyverse)
```

## `pivot longer`

```{r}
pulse = 
  haven::read_sas("./data/public_pulse_data.sas7bdat") %>% 
  janitor::clean_names()
```

We do not want 4 diff columns for BDI score, but one column. We willend up with some data duplication (but we're not worried about that??)

Wide format to long format
```{r}
pulse_tidy = 
  pulse %>% 
  pivot_longer(
    bdi_score_bl:bdi_score_12m,
    names_to = "visit",
    names_prefix = "bdi_score_",
    values_to = "bdi"
  )
#when tidying data, the bdi scores will be their own column, they need their own name, which we've named here as "visit". Their values will no longer fall under their current columns and need to be renamed as well to "bdi"

#so, we also don't need the long ass name for the visit variable.  bdi_score_bl can just be "bl" or "baseline".  The `names_prefix` fn removes it.  NEXT time, fix bl to 0m for consistency (IN THE NEXT CODE CHUNK.
```

rewrite, combine and extend (to add mutate)

```{r}
pulse_tidy = 
  pulse %>% 
  pivot_longer(
    bdi_score_bl:bdi_score_12m,
    names_to = "visit",
    names_prefix = "bdi_score_",
    values_to = "bdi"
  ) %>% 
 relocate(id, visit) %>% 
  mutate(visit = recode(visit, "bl" = "oom"))

```


## `pivot_wider`

Make up some data!

```{r}
analysis = 
  tibble(
    group = c("treatment", "treatment", "placebo", "placebo"),
    time = c("pre", "post", "pre", "post"),
    mean = c(4, 8, 3.5, 4)
  )

#if you want ot put it in a paper, so someone can look at it.

analysis %>% 
  pivot_wider(
    names_from = "time",
    values_from = "mean"
  )

#pull the names from the columns.  The data in the columns become the new column names
```



## Binding rows
Using lord of the rings data. 
First step: import each table. (create three sep data structures.  I think we can only import certain rows.)

```{r}
fellowship = 
  readxl::read_excel("./data/LotR_Words.xlsx", range = "B3:D6") %>% 
  mutate(movie = "fellowship")

twotowers = 
  readxl::read_excel("./data/LotR_Words.xlsx", range = "F3:H6") %>% 
  mutate(movie = "twotowers")

returnking = 
  readxl::read_excel("./data/LotR_Words.xlsx", range = "J3:L6") %>% 
  mutate(movie = "returnking")

#mutate here adds the variable "movie" and the values are "fellowship", "twotowers", "returnking".
```

Bind all rows together

```{r}
lotr_tidy = 
  bind_rows(fellowship, twotowers, returnking) %>% 
#we want to tidy more, no need for male and female columns, it can be under one "sex" and the values under "words"
  janitor::clean_names() %>% 
  relocate(movie) %>% 
  pivot_longer(
    female:male,
    names_to = "gender",
    values_to = "words"
  )

#make tidyer and make "Elf" "Hobbit" all lowercase
```

## Joining datasets

import FAS datasets

```{r}
pups = 
  read_csv("./data/FAS_pups.csv") %>% 
  janitor::clean_names() %>% 
  mutate(sex = recode(sex, `1` = "male", `2` = "female"))

litters = 
  read_csv("./data/FAS_litters.csv") %>% 
  janitor::clean_names() %>% 
  relocate(litter_number) %>% 
  separate(group, into = c("dose", "day_of_tx"), sep = 3) 
#sep = 3 bc the first three letters are categorized by dose. 
  
# we are going to merge the litter level information into the pups dataset. Litter number is the key, it exists in both places. 
```

The group column is annoying bc it contains values of diff types of treatments and on diff days.  We want to separate it to two different variables. (done in code chunk above) 


Next up, join them!!!

```{r}
fas = 
  left_join(pups, litters, by = "litter_number") %>% 
  arrange(litter_number) %>% 
  relocate(litter_number, dose, day_of_tx)

```

